<%inherit file="base/default.mhtml" />
<%!
import re

def summary(s):
    s = re.sub(r'^\s+#+[^\n]+\s+', '', s)
    s = re.sub(r'^\s+', '', s)
    s = re.sub(r'\n\n[\s\S]*', '', s)
    return s or '--?--'
%>
<%namespace file="/lib/pagination.mc" import="paginate, prevnext" />

<%block name="content">
<%
    posts = self.all_posts()
    page_size = context.get('site_paginate', 5)
    posts_page, page_count, page, page_urls = paginate(posts, page_size)
%>
<div class="posts">
  % for post in posts_page:
    <div class="post">
      <h1 class="post-title">
        <a href="${ post['url'] }">
          ${ post['data']['title'] }
        </a>
      </h1>
      <span class="post-date">${ post['data'].get('pubdate',None) or post['data'].get('MTIME') | self.attr.date_format }</span>
      ## ${ post['data'].get('summary') or summary(post['doc']) }
      ${ post['rendered'] }
  </div>
  % endfor
</div>

% if page_count > 1:
  ${ prevnext(page_count, page, page_urls) }
% endif
</%block>

<%def name="page_title()">Forsíða &middot; ${ site_title }</%def>

